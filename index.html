<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>存货小管家 — 保质期与库存管理</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div class="app">
    <!-- 主内容区：四个页面通过 JS 切换显示 -->
    <main class="main">
      <section id="view-home" class="view view-active" data-view="home">
        <div class="view-inner">
          <header class="page-header">
            <h1 class="page-title">今日提醒</h1>
          </header>
          <div class="hamster-card">
            <div class="hamster-character hamster-employee" aria-hidden="true"></div>
            <div class="card-content">
              <div id="home-empty-msg" class="empty-msg hidden">今天没有快过期的东西，真棒！</div>
              <p id="home-urging-msg" class="urging-msg hidden"></p>
              <ul id="home-expiring-list" class="expiring-list"></ul>
            </div>
          </div>
          <div class="home-send-email">
            <button type="button" class="btn btn-secondary" id="btn-send-report">发送今日报告到邮箱</button>
            <span id="send-report-status" class="send-status hidden"></span>
          </div>
          <section class="biweekly-section" id="home-biweekly">
            <h2 class="biweekly-title">货单总结</h2>
            <div id="biweekly-new" class="biweekly-block"></div>
            <div id="biweekly-used" class="biweekly-block"></div>
          </section>
        </div>
      </section>

      <section id="view-inventory" class="view" data-view="inventory">
        <div class="view-inner">
          <header class="page-header with-action">
            <h1 class="page-title">库存管理</h1>
            <button type="button" class="btn btn-primary btn-add" id="btn-add-item">进货</button>
          </header>
          <div class="hamster-admin">
            <div class="hamster-character hamster-admin" aria-hidden="true"></div>
            <div class="admin-table-wrap">
              <div id="inventory-stamp" class="stamp hidden" aria-hidden="true">已登记</div>
              <div class="table-scroll">
                <table class="inventory-table" id="inventory-table">
                  <thead>
                    <tr>
                      <th class="col-expand"></th>
                      <th>物品</th>
                      <th>品类</th>
                      <th>品牌</th>
                      <th>总数量</th>
                      <th>总价（元）</th>
                      <th>到期范围</th>
                    </tr>
                  </thead>
                  <tbody id="inventory-tbody"></tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- 筛选：在库 / 已用完 -->
          <div class="filter-bar">
            <button type="button" class="filter-btn active" data-status="in_stock">在库</button>
            <button type="button" class="filter-btn" data-status="used_up">已用完</button>
          </div>
        </div>
      </section>

      <section id="view-butler" class="view" data-view="butler">
        <div class="view-inner">
          <header class="page-header">
            <h1 class="page-title">管家</h1>
          </header>
          <div class="butler-placeholder">
            <div class="hamster-character hamster-holding-report" aria-hidden="true"></div>
            <p class="butler-desc">预留接入 DeepSeek、通义千问、豆包等大模型，实现智能管家对话与服务。</p>
            <p class="butler-hint">后续版本将支持连接自己的大模型账户，通过读取库存数据提供对话与建议。</p>
          </div>
        </div>
      </section>

      <section id="view-settings" class="view" data-view="settings">
        <div class="view-inner">
          <header class="page-header">
            <h1 class="page-title">设置</h1>
          </header>
          <div class="settings-list">
            <div class="settings-group-label">提醒设定</div>
            <div class="setting-item">
              <label for="setting-remind-cycle">提醒周期</label>
              <select id="setting-remind-cycle">
                <option value="1">每天</option>
                <option value="3">每 3 天</option>
                <option value="7" selected>每周</option>
                <option value="14">每两周</option>
              </select>
              <span class="setting-desc">每周定时向邮箱发送今日报告内容</span>
            </div>
            <div class="setting-item">
              <label for="setting-notify-email">通知邮箱</label>
              <input type="email" id="setting-notify-email" placeholder="接收提醒的邮箱地址" />
            </div>
            <div class="settings-group-label">数据</div>
            <div class="setting-item">
              <label>数据存储</label>
              <span class="setting-desc">当前：本地存储 · Notion 同步（开发中）</span>
            </div>
            <div class="settings-group-label">AI 管家</div>
            <div class="setting-item">
              <label>AI Agent 接入</label>
              <span class="setting-desc">后续版本可连接自己的大模型账户（DeepSeek / 千问 / 豆包等），通过读取库存数据实现管家页对话与服务</span>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- 底部导航 -->
    <nav class="bottom-nav" role="navigation">
      <button type="button" class="nav-item active" data-nav="home" aria-label="首页">
        <span class="nav-icon">🏠</span>
        <span class="nav-label">首页</span>
      </button>
      <button type="button" class="nav-item" data-nav="inventory" aria-label="库存管理">
        <span class="nav-icon">📦</span>
        <span class="nav-label">库存</span>
      </button>
      <button type="button" class="nav-item" data-nav="butler" aria-label="管家">
        <span class="nav-icon">🤖</span>
        <span class="nav-label">管家</span>
      </button>
      <button type="button" class="nav-item" data-nav="settings" aria-label="设置">
        <span class="nav-icon">⚙️</span>
        <span class="nav-label">设置</span>
      </button>
    </nav>
  </div>

  <!-- 添加/编辑 弹层：仓库申请卡片式表单 -->
  <div id="modal-form" class="modal hidden" aria-hidden="true">
    <div class="modal-backdrop" id="modal-close"></div>
    <div class="modal-content form-card">
      <div class="form-card-header">
        <h2 id="form-title">登记新货物</h2>
        <button type="button" class="btn-close" id="form-close" aria-label="关闭">×</button>
      </div>
      <form id="item-form" class="item-form">
        <input type="hidden" id="item-id" name="id" />
        <div class="form-row">
          <label for="item-name">物品名称 <span class="required">*</span></label>
          <input type="text" id="item-name" name="name" required placeholder="如：鲜牛奶" />
        </div>
        <div class="form-row form-row-copy">
          <label>从已有复制</label>
          <input type="text" id="item-copy-search" placeholder="输入关键字搜索后从下拉选择" autocomplete="off" />
          <div id="item-copy-list" class="copy-list copy-list-dropdown hidden"></div>
        </div>
        <div class="form-row">
          <label for="item-category1">一级品类 <span class="required">*</span></label>
          <input type="text" id="item-category1" name="category1" list="list-category1" required placeholder="如：食品" />
          <datalist id="list-category1"></datalist>
        </div>
        <div class="form-row">
          <label for="item-category2">二级品类 <span class="required">*</span></label>
          <input type="text" id="item-category2" name="category2" list="list-category2" required placeholder="如：牛奶" />
          <datalist id="list-category2"></datalist>
        </div>
        <div class="form-row">
          <label for="item-brand">品牌 <span class="required">*</span></label>
          <input type="text" id="item-brand" name="brand" required placeholder="如：某某牌" />
        </div>
        <div class="form-row form-row-half">
          <label for="item-quantity">数量 <span class="required">*</span></label>
          <input type="number" id="item-quantity" name="quantity" min="0.001" step="any" required placeholder="1" />
        </div>
        <div class="form-row form-row-half">
          <label for="item-unit-price">单位价格（元）<span class="required">*</span></label>
          <input type="number" id="item-unit-price" name="unitPrice" min="0" step="0.01" required placeholder="0" />
        </div>
        <div class="form-row form-row-half">
          <label for="item-purchase-date">购买日期 <span class="required">*</span></label>
          <input type="date" id="item-purchase-date" name="purchaseDate" required />
        </div>
        <div class="form-row form-row-half">
          <label for="item-expiry-date">保质期/赏味期 <span class="required">*</span></label>
          <input type="date" id="item-expiry-date" name="expiryDate" required />
        </div>
        <div class="form-row">
          <label for="item-remind-days">提前多少天提醒 <span class="required">*</span></label>
          <input type="number" id="item-remind-days" name="remindBeforeDays" min="1" max="365" value="30" placeholder="30" />
          <span class="form-hint">默认 30 天，可在编辑时修改</span>
        </div>
        <div class="form-row">
          <label for="item-note">备注</label>
          <input type="text" id="item-note" name="note" placeholder="如：放冰箱上层" />
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" id="form-cancel">取消</button>
          <button type="submit" class="btn btn-primary">保存</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 用完了：填写本次使用数量 -->
  <div id="modal-use" class="modal hidden" aria-hidden="true">
    <div class="modal-backdrop" id="modal-use-close"></div>
    <div class="modal-content modal-use-content">
      <div class="form-card-header">
        <h2>本次使用数量</h2>
        <button type="button" class="btn-close" id="modal-use-close-btn" aria-label="关闭">×</button>
      </div>
      <div class="modal-use-body">
        <p id="use-item-desc" class="use-item-desc"></p>
        <div class="form-row">
          <label for="use-quantity">数量</label>
          <input type="number" id="use-quantity" min="0" step="any" value="1" required />
          <span class="form-hint">最多 <span id="use-quantity-max">0</span></span>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" id="use-cancel">取消</button>
          <button type="button" class="btn btn-primary" id="use-confirm">确定</button>
        </div>
      </div>
    </div>
  </div>

  <script src="js/data.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
